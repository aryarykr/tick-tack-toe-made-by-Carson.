<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tic Tac Toe + Shop</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      text-align: center;
      background: #f7f7f7;
      color: #000;
      user-select: none;
    }
    #ui {
      position: fixed;
      top: 0; left: 0; right: 0;
      background: white;
      padding: 10px;
      border-bottom: 1px solid #ccc;
      z-index: 10;
    }
    #currency {
      font-weight: bold;
    }
    #stats {
      font-size: 14px;
      margin-top: 4px;
    }
    #tttGame {
      padding-top: 110px;
    }
    #board {
      width: 306px;
      margin: 20px auto;
      display: flex;
      flex-wrap: wrap;
    }
    .cell {
      width: 100px;
      height: 100px;
      border: 1px solid black;
      font-size: 60px;
      line-height: 100px;
      cursor: pointer;
      position: relative;
    }
    .cell.highlight {
      background-color: yellow;
    }
    #tttStatus {
      height: 30px;
      font-size: 18px;
      margin: 10px 0;
    }
    #shop {
      max-width: 350px;
      margin: 20px auto;
      text-align: left;
    }
    .shopItem {
      padding: 8px;
      border-bottom: 1px solid #ccc;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .shopItem button {
      padding: 5px 10px;
      cursor: pointer;
    }
    #modeButtons button {
      margin: 0 5px;
      padding: 8px 12px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<audio id="bgMusic" src="https://cdn.pixabay.com/audio/2023/03/03/audio_96ecb1d20f.mp3" autoplay loop></audio>

<div id="ui">
  <div id="modeButtons">
    <button onclick="setMode('friend')">Play vs Friend</button>
    <button onclick="setMode('bot')">Play vs Bot</button>
    <button onclick="setMode('botvsbot')">Bot vs Bot</button>
  </div>
  <div id="currency">Dab Cones: 0</div>
  <div id="stats">Wins: 0 | Losses: 0 | Draws: 0</div>
</div>

<div id="tttGame">
  <h1>Tic Tac Toe</h1>
  <div id="board"></div>
  <div id="tttStatus"></div>
  <div id="shop"></div>
</div>

<script>
let board = [];
let currentTurn = 'X';
let mode = 'friend';
let gameOver = false;
let cones = 0;
let wins = 0, losses = 0, draws = 0;
let shopItems = [
  { name: "Win Bonus", cost: 50, rounds: 2, bought: 0 },
  { name: "Highlight Wins", cost: 30, rounds: 2, bought: 0 },
  { name: "Extra Move", cost: 70, rounds: 2, bought: 0 },
  { name: "Background Flash", cost: 90, rounds: 1, bought: 0 },
  { name: "HE HE HE HA Spam", cost: 40, rounds: 1, bought: 0 }
];

function updateCurrency() {
  document.getElementById('currency').textContent = `Dab Cones: ${cones}`;
}

function updateStats() {
  document.getElementById('stats').textContent = `Wins: ${wins} | Losses: ${losses} | Draws: ${draws}`;
}

function setMode(m) {
  mode = m;
  startGame();
}

function startGame() {
  board = Array(9).fill('');
  currentTurn = 'X';
  gameOver = false;
  renderBoard();
  updateStatus(`Turn: ${currentTurn}`);
  renderShop();
  if (mode === 'botvsbot') botVsBot();
  if (mode === 'bot' && currentTurn === 'O') setTimeout(botMove, 700);
  updateCurrency();
  updateStats();
}

function renderBoard() {
  const boardDiv = document.getElementById('board');
  boardDiv.innerHTML = '';
  board.forEach((cell, idx) => {
    const div = document.createElement('div');
    div.className = 'cell';
    div.textContent = cell;
    div.onclick = () => handleClick(idx);
    boardDiv.appendChild(div);
  });
}

function handleClick(i) {
  if (gameOver || board[i]) return;
  if (mode === 'botvsbot') return;
  if (mode === 'bot' && currentTurn === 'O') return;
  board[i] = currentTurn;
  renderBoard();
  checkGameEnd();
  if (!gameOver) {
    currentTurn = currentTurn === 'X' ? 'O' : 'X';
    updateStatus(`Turn: ${currentTurn}`);
    if (mode === 'bot' && currentTurn === 'O') setTimeout(botMove, 500);
  }
}

function updateStatus(text) {
  document.getElementById('tttStatus').textContent = text;
}

function checkGameEnd() {
  const winsCombos = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];
  for (let combo of winsCombos) {
    const [a, b, c] = combo;
    if (board[a] && board[a] === board[b] && board[b] === board[c]) {
      highlightCells(combo);
      updateStatus(`${board[a]} Wins!`);
      gameOver = true;
      if (mode === 'bot') {
        if (board[a] === 'X') {
          wins++;
          cones += 100;
        } else {
          losses++;
          cones -= 100;
        }
        updateCurrency();
        updateStats();
      }
      setTimeout(startGame, 2000);
      return;
    }
  }
  if (!board.includes('')) {
    updateStatus('Draw!');
    if (mode === 'bot') {
      draws++;
      updateStats();
    }
    gameOver = true;
    setTimeout(startGame, 2000);
  }
}

function highlightCells(cells) {
  const cellDivs = document.querySelectorAll('.cell');
  cells.forEach(i => cellDivs[i].classList.add('highlight'));
}

function botMove() {
  let empty = board.map((v, i) => v === '' ? i : null).filter(v => v !== null);
  if (empty.length === 0) return;
  let move = empty[Math.floor(Math.random() * empty.length)];
  handleClick(move);
}

function botVsBot() {
  if (gameOver) return;
  let empty = board.map((v, i) => v === '' ? i : null).filter(v => v !== null);
  if (empty.length === 0) return;
  let move = empty[Math.floor(Math.random() * empty.length)];
  board[move] = currentTurn;
  renderBoard();
  checkGameEnd();
  if (!gameOver) {
    currentTurn = currentTurn === 'X' ? 'O' : 'X';
    updateStatus(`Turn: ${currentTurn}`);
    setTimeout(botVsBot, 500);
  }
}

function renderShop() {
  const shop = document.getElementById('shop');
  shop.innerHTML = "<h3>Shop</h3>";
  shopItems.forEach((item, i) => {
    const div = document.createElement('div');
    div.className = 'shopItem';
    div.innerHTML = `
      <span>${item.name} (${item.cost} cones)</span>
      <button ${item.bought ? "disabled" : ""} onclick="buyItem(${i})">
        ${item.bought ? "Owned" : "Buy"}
      </button>
    `;
    shop.appendChild(div);
  });
}

function buyItem(i) {
  const item = shopItems[i];
  if (cones >= item.cost && !item.bought) {
    cones -= item.cost;
    item.bought = true;
    alert(`You bought: ${item.name}`);
    updateCurrency();
    renderShop();
  } else if (!item.bought) {
    alert("Not enough cones!");
  }
}

startGame();
</script>
</body>
</html>

