<!DOCTYPE html>
<html lang="="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tic Tac Toe + Shop</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      text-align: center;
      background: #f7f7f7;
      color: #000;
      user-select: none;
      transition: background 0.2s;
    }
    #ui {
      position: fixed;
      top: 0; left: 0; right: 0;
      background: white;
      padding: 10px;
      border-bottom: 1px solid #ccc;
      z-index: 10;
    }
    #currency {
      font-weight: bold;
      margin-top: 5px;
    }
    #buyMessage {
      margin: 5px 0;
      color: green;
      font-weight: bold;
      height: 20px;
      min-height: 20px;
    }
    #tttGame {
      padding-top: 90px;
    }
    #board {
      width: 306px;
      margin: 20px auto;
      display: flex;
      flex-wrap: wrap;
    }
    .cell {
      width: 100px;
      height: 100px;
      border: 1px solid black;
      font-size: 60px;
      line-height: 100px;
      cursor: pointer;
      position: relative;
    }
    .cell.highlight {
      background-color: yellow;
    }
    #tttStatus {
      height: 30px;
      font-size: 18px;
      margin: 10px 0;
    }
    #shop {
      max-width: 400px;
      margin: 20px auto;
      text-align: left;
    }
    .shopItem {
      padding: 8px;
      border-bottom: 1px solid #ccc;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .shopItem button {
      padding: 5px 10px;
      cursor: pointer;
    }
    #modeButtons button {
      margin: 0 5px;
      padding: 8px 12px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="ui">
  <div id="modeButtons">
    <button onclick="setMode('friend')">Play vs Friend</button>
    <button onclick="setMode('bot')">Play vs Bot</button>
    <button onclick="setMode('botvsbot')">Bot vs Bot</button>
  </div>
  <div id="currency">Dab Cones: 0</div>
  <div id="buyMessage"></div>
</div>

<div id="tttGame">
  <h1>Tic Tac Toe</h1>
  <div id="board"></div>
  <div id="tttStatus"></div>
  <div id="shop"></div>
</div>

<script>
let board = [];
let currentTurn = 'X';
let mode = 'friend';
let gameOver = false;
let cones = 0;
let effects = {};
let botMoveTimeout = null;

let shopItems = [
  { name: "Win Bonus (x2)", cost: 50, key: "winBonus", duration: 2 },
  { name: "Extra Move", cost: 80, key: "extraMove", duration: 2 },
  { name: "Highlight Win", cost: 40, key: "highlightWin", duration: 2 },
  { name: "Flash Screen", cost: 90, key: "flashScreen" },
  { name: "Smart Bot (Nerfed)", cost: 150, key: "smartBot", duration: 2 }
];

function updateCurrency() {
  document.getElementById('currency').textContent = `Dab Cones: ${cones}`;
}

function setMode(m) {
  mode = m;
  startGame();
}

function startGame() {
  board = Array(9).fill('');
  currentTurn = 'X';
  gameOver = false;
  for (let k in effects) {
    if (typeof effects[k] === 'number') {
      effects[k] = Math.max(0, effects[k] - 1);
      if (effects[k] === 0) delete effects[k];
    }
  }
  renderBoard();
  updateStatus(`Turn: ${currentTurn}`);
  renderShop();
  updateCurrency();
  if (mode === 'botvsbot') botVsBot();
  if (mode === 'bot' && currentTurn === 'O') {
    setTimeout(() => {
      if (!gameOver) botMove();
    }, 400);
  }
}

function renderBoard() {
  const boardDiv = document.getElementById('board');
  boardDiv.innerHTML = '';
  board.forEach((cell, idx) => {
    const div = document.createElement('div');
    div.className = 'cell';
    div.textContent = cell;
    div.onclick = () => handleClick(idx);
    boardDiv.appendChild(div);
  });
}

function handleClick(i) {
  if (gameOver || board[i]) return;
  if (mode === 'botvsbot') return;
  if (mode === 'bot' && currentTurn === 'O') return;
  makeMove(i);
}

function makeMove(i) {
  if (gameOver || board[i]) return;
  board[i] = currentTurn;
  renderBoard();
  checkGameEnd();
  if (!gameOver) {
    if (effects.extraMove && effects.extraMove > 0 && currentTurn === 'X') {
      effects.extraMove--;
    } else {
      currentTurn = currentTurn === 'X' ? 'O' : 'X';
    }
    updateStatus(`Turn: ${currentTurn}`);
    if (mode === 'bot' && currentTurn === 'O') {
      setTimeout(() => {
        if (!gameOver && currentTurn === 'O') {
          effects.smartBot ? nerfedSmartBotMove() : botMove();
        }
      }, 300);
      botMoveTimeout = setTimeout(() => {
        if (!gameOver && currentTurn === 'O') {
          console.log("Forcing bot move");
          effects.smartBot ? nerfedSmartBotMove() : botMove();
        }
      }, 2000);
    }
  }
}

function updateStatus(text) {
  document.getElementById('tttStatus').textContent = text;
}

function checkGameEnd() {
  const wins = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];
  for (let combo of wins) {
    const [a, b, c] = combo;
    if (board[a] && board[a] === board[b] && board[b] === board[c]) {
      if (effects.highlightWin) highlightCells(combo);
      updateStatus(`${board[a]} Wins!`);
      gameOver = true;
      if (mode === 'bot' && board[a] === 'X') cones += effects.winBonus ? 200 : 100;
      if (mode === 'bot' && board[a] === 'O') cones -= 100;
      updateCurrency();
      setTimeout(startGame, 2000);
      return;
    }
  }
  if (!board.includes('')) {
    updateStatus('Draw!');
    gameOver = true;
    setTimeout(startGame, 2000);
  }
}

function highlightCells(cells) {
  const cellDivs = document.querySelectorAll('.cell');
  cells.forEach(i => cellDivs[i].classList.add('highlight'));
}

function botMove() {
  let empty = board.map((v, i) => v === '' ? i : null).filter(v => v !== null);
  if (empty.length === 0) return;
  let move = empty[Math.floor(Math.random() * empty.length)];
  makeMove(move);
}

function nerfedSmartBotMove() {
  if (Math.random() < 0.7) {
    const bestMove = minimax(board, 'O').index;
    makeMove(bestMove);
  } else {
    botMove();
  }
}

function minimax(newBoard, player) {
  const availSpots = newBoard.map((v, i) => v === '' ? i : null).filter(v => v !== null);
  if (checkWin(newBoard, 'X')) return { score: -10 };
  if (checkWin(newBoard, 'O')) return { score: 10 };
  if (availSpots.length === 0) return { score: 0 };
  let moves = [];
  for (let i = 0; i < availSpots.length; i++) {
    let move = {};
    move.index = availSpots[i];
    newBoard[availSpots[i]] = player;
    let result = minimax(newBoard, player === 'O' ? 'X' : 'O');
    move.score = result.score;
    newBoard[availSpots[i]] = '';
    moves.push(move);
  }
  return moves.reduce((best, m) =>
    (player === 'O' ? m.score > best.score : m.score < best.score) ? m : best);
}

function checkWin(brd, player) {
  const wins = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];
  return wins.some(combo => combo.every(i => brd[i] === player));
}

function botVsBot() {
  if (gameOver) return setTimeout(startGame, 1000);
  let empty = board.map((v, i) => v === '' ? i : null).filter(v => v !== null);
  if (empty.length === 0) return;
  let move = empty[Math.floor(Math.random() * empty.length)];
  board[move] = currentTurn;
  renderBoard();
  checkGameEnd();
  if (!gameOver) {
    currentTurn = currentTurn === 'X' ? 'O' : 'X';
    updateStatus(`Turn: ${currentTurn}`);
    setTimeout(botVsBot, 500);
  }
}

function renderShop() {
  const shop = document.getElementById('shop');
  shop.innerHTML = "<h3>Shop</h3>";
  shopItems.forEach((item, idx) => {
    const div = document.createElement('div');
    div.className = 'shopItem';
    div.innerHTML = `
      <span>${item.name} (${item.cost})</span>
      <button onclick="buyItem(${idx})">Buy</button>
    `;
    shop.appendChild(div);
  });
}

function buyItem(i) {
  const item = shopItems[i];
  if(cones >= item.cost){
    cones -= item.cost;
    if (item.key === "flashScreen") {
      flashScreenEffect();
    } else if(typeof effects[item.key] === 'number'){
      effects[item.key] += item.duration;
    } else {
      effects[item.key] = item.duration || true;
    }
    updateCurrency();
    renderShop();
    showBuyMessage(`Bought: ${item.name}`);
  } else {
    showBuyMessage(`Not enough Dab Cones!`, true);
  }
}

function flashScreenEffect() {
  let flashes = 100;
  const colors = ['#f00','#0f0','#00f','#ff0','#0ff','#f0f'];
  let i = 0;
  const interval = setInterval(() => {
    document.body.style.background = colors[i % colors.length];
    i++;
    if(i > flashes) {
      clearInterval(interval);
      document.body.style.background = '#f7f7f7';
    }
  }, 100);
}

function showBuyMessage(msg, error=false){
  const div = document.getElementById('buyMessage');
  div.style.color = error ? 'red' : 'green';
  div.textContent = msg;
  setTimeout(() => div.textContent = '', 2500);
}

startGame();
</script>
</body>
</html>

  <!DOCTYPE html>
<html lang="="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tic Tac Toe + Shop</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      text-align: center;
      background: #f7f7f7;
      color: #000;
      user-select: none;
      transition: background 0.2s;
    }
    #ui {
      position: fixed;
      top: 0; left: 0; right: 0;
      background: white;
      padding: 10px;
      border-bottom: 1px solid #ccc;
      z-index: 10;
    }
    #currency {
      font-weight: bold;
      margin-top: 5px;
    }
    #buyMessage {
      margin: 5px 0;
      color: green;
      font-weight: bold;
      height: 20px;
      min-height: 20px;
    }
    #tttGame {
      padding-top: 90px;
    }
    #board {
      width: 306px;
      margin: 20px auto;
      display: flex;
      flex-wrap: wrap;
    }
    .cell {
      width: 100px;
      height: 100px;
      border: 1px solid black;
      font-size: 60px;
      line-height: 100px;
      cursor: pointer;
      position: relative;
    }
    .cell.highlight {
      background-color: yellow;
    }
    #tttStatus {
      height: 30px;
      font-size: 18px;
      margin: 10px 0;
    }
    #shop {
      max-width: 400px;
      margin: 20px auto;
      text-align: left;
    }
    .shopItem {
      padding: 8px;
      border-bottom: 1px solid #ccc;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .shopItem button {
      padding: 5px 10px;
      cursor: pointer;
    }
    #modeButtons button {
      margin: 0 5px;
      padding: 8px 12px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="ui">
  <div id="modeButtons">
    <button onclick="setMode('friend')">Play vs Friend</button>
    <button onclick="setMode('bot')">Play vs Bot</button>
    <button onclick="setMode('botvsbot')">Bot vs Bot</button>
  </div>
  <div id="currency">Dab Cones: 0</div>
  <div id="buyMessage"></div>
</div>

<div id="tttGame">
  <h1>Tic Tac Toe</h1>
  <div id="board"></div>
  <div id="tttStatus"></div>
  <div id="shop"></div>
</div>

<script>
let board = [];
let currentTurn = 'X';
let mode = 'friend';
let gameOver = false;
let cones = 0;
let effects = {};
let botMoveTimeout = null;

let shopItems = [
  { name: "Win Bonus (x2)", cost: 50, key: "winBonus", duration: 2 },
  { name: "Extra Move", cost: 80, key: "extraMove", duration: 2 },
  { name: "Highlight Win", cost: 40, key: "highlightWin", duration: 2 },
  { name: "Flash Screen", cost: 90, key: "flashScreen" },
  { name: "Smart Bot (Nerfed)", cost: 150, key: "smartBot", duration: 2 }
];

function updateCurrency() {
  document.getElementById('currency').textContent = `Dab Cones: ${cones}`;
}

function setMode(m) {
  mode = m;
  startGame();
}

function startGame() {
  board = Array(9).fill('');
  currentTurn = 'X';
  gameOver = false;
  for (let k in effects) {
    if (typeof effects[k] === 'number') {
      effects[k] = Math.max(0, effects[k] - 1);
      if (effects[k] === 0) delete effects[k];
    }
  }
  renderBoard();
  updateStatus(`Turn: ${currentTurn}`);
  renderShop();
  updateCurrency();
  if (mode === 'botvsbot') botVsBot();
  if (mode === 'bot' && currentTurn === 'O') {
    setTimeout(() => {
      if (!gameOver) botMove();
    }, 400);
  }
}

function renderBoard() {
  const boardDiv = document.getElementById('board');
  boardDiv.innerHTML = '';
  board.forEach((cell, idx) => {
    const div = document.createElement('div');
    div.className = 'cell';
    div.textContent = cell;
    div.onclick = () => handleClick(idx);
    boardDiv.appendChild(div);
  });
}

function handleClick(i) {
  if (gameOver || board[i]) return;
  if (mode === 'botvsbot') return;
  if (mode === 'bot' && currentTurn === 'O') return;
  makeMove(i);
}

function makeMove(i) {
  if (gameOver || board[i]) return;
  board[i] = currentTurn;
  renderBoard();
  checkGameEnd();
  if (!gameOver) {
    if (effects.extraMove && effects.extraMove > 0 && currentTurn === 'X') {
      effects.extraMove--;
    } else {
      currentTurn = currentTurn === 'X' ? 'O' : 'X';
    }
    updateStatus(`Turn: ${currentTurn}`);
    if (mode === 'bot' && currentTurn === 'O') {
      setTimeout(() => {
        if (!gameOver && currentTurn === 'O') {
          effects.smartBot ? nerfedSmartBotMove() : botMove();
        }
      }, 300);
      botMoveTimeout = setTimeout(() => {
        if (!gameOver && currentTurn === 'O') {
          console.log("Forcing bot move");
          effects.smartBot ? nerfedSmartBotMove() : botMove();
        }
      }, 2000);
    }
  }
}

function updateStatus(text) {
  document.getElementById('tttStatus').textContent = text;
}

function checkGameEnd() {
  const wins = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];
  for (let combo of wins) {
    const [a, b, c] = combo;
    if (board[a] && board[a] === board[b] && board[b] === board[c]) {
      if (effects.highlightWin) highlightCells(combo);
      updateStatus(`${board[a]} Wins!`);
      gameOver = true;
      if (mode === 'bot' && board[a] === 'X') cones += effects.winBonus ? 200 : 100;
      if (mode === 'bot' && board[a] === 'O') cones -= 100;
      updateCurrency();
      setTimeout(startGame, 2000);
      return;
    }
  }
  if (!board.includes('')) {
    updateStatus('Draw!');
    gameOver = true;
    setTimeout(startGame, 2000);
  }
}

function highlightCells(cells) {
  const cellDivs = document.querySelectorAll('.cell');
  cells.forEach(i => cellDivs[i].classList.add('highlight'));
}

function botMove() {
  let empty = board.map((v, i) => v === '' ? i : null).filter(v => v !== null);
  if (empty.length === 0) return;
  let move = empty[Math.floor(Math.random() * empty.length)];
  makeMove(move);
}

function nerfedSmartBotMove() {
  if (Math.random() < 0.7) {
    const bestMove = minimax(board, 'O').index;
    makeMove(bestMove);
  } else {
    botMove();
  }
}

function minimax(newBoard, player) {
  const availSpots = newBoard.map((v, i) => v === '' ? i : null).filter(v => v !== null);
  if (checkWin(newBoard, 'X')) return { score: -10 };
  if (checkWin(newBoard, 'O')) return { score: 10 };
  if (availSpots.length === 0) return { score: 0 };
  let moves = [];
  for (let i = 0; i < availSpots.length; i++) {
    let move = {};
    move.index = availSpots[i];
    newBoard[availSpots[i]] = player;
    let result = minimax(newBoard, player === 'O' ? 'X' : 'O');
    move.score = result.score;
    newBoard[availSpots[i]] = '';
    moves.push(move);
  }
  return moves.reduce((best, m) =>
    (player === 'O' ? m.score > best.score : m.score < best.score) ? m : best);
}

function checkWin(brd, player) {
  const wins = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];
  return wins.some(combo => combo.every(i => brd[i] === player));
}

function botVsBot() {
  if (gameOver) return setTimeout(startGame, 1000);
  let empty = board.map((v, i) => v === '' ? i : null).filter(v => v !== null);
  if (empty.length === 0) return;
  let move = empty[Math.floor(Math.random() * empty.length)];
  board[move] = currentTurn;
  renderBoard();
  checkGameEnd();
  if (!gameOver) {
    currentTurn = currentTurn === 'X' ? 'O' : 'X';
    updateStatus(`Turn: ${currentTurn}`);
    setTimeout(botVsBot, 500);
  }
}

function renderShop() {
  const shop = document.getElementById('shop');
  shop.innerHTML = "<h3>Shop</h3>";
  shopItems.forEach((item, idx) => {
    const div = document.createElement('div');
    div.className = 'shopItem';
    div.innerHTML = `
      <span>${item.name} (${item.cost})</span>
      <button onclick="buyItem(${idx})">Buy</button>
    `;
    shop.appendChild(div);
  });
}

function buyItem(i) {
  const item = shopItems[i];
  if(cones >= item.cost){
    cones -= item.cost;
    if (item.key === "flashScreen") {
      flashScreenEffect();
    } else if(typeof effects[item.key] === 'number'){
      effects[item.key] += item.duration;
    } else {
      effects[item.key] = item.duration || true;
    }
    updateCurrency();
    renderShop();
    showBuyMessage(`Bought: ${item.name}`);
  } else {
    showBuyMessage(`Not enough Dab Cones!`, true);
  }
}

function flashScreenEffect() {
  let flashes = 100;
  const colors = ['#f00','#0f0','#00f','#ff0','#0ff','#f0f'];
  let i = 0;
  const interval = setInterval(() => {
    document.body.style.background = colors[i % colors.length];
    i++;
    if(i > flashes) {
      clearInterval(interval);
      document.body.style.background = '#f7f7f7';
    }
  }, 100);
}

function showBuyMessage(msg, error=false){
  const div = document.getElementById('buyMessage');
  div.style.color = error ? 'red' : 'green';
  div.textContent = msg;
  setTimeout(() => div.textContent = '', 2500);
}

startGame();
</script>
</body>
</html>

