<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tic Tac Toe + Shop</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      text-align: center;
      background: #f7f7f7;
      color: #000;
      user-select: none;
    }
    #ui {
      position: fixed;
      top: 0; left: 0; right: 0;
      background: white;
      padding: 10px;
      border-bottom: 1px solid #ccc;
      z-index: 10;
    }
    #currency {
      font-weight: bold;
      margin-top: 5px;
    }
    #tttGame {
      padding-top: 90px;
    }
    #board {
      width: 306px;
      margin: 20px auto;
      display: flex;
      flex-wrap: wrap;
    }
    .cell {
      width: 100px;
      height: 100px;
      border: 1px solid black;
      font-size: 60px;
      line-height: 100px;
      cursor: pointer;
      position: relative;
    }
    .cell.highlight {
      background-color: yellow;
    }
    #tttStatus {
      height: 30px;
      font-size: 18px;
      margin: 10px 0;
    }
    #shop {
      max-width: 350px;
      margin: 20px auto;
      text-align: left;
    }
    .shopItem {
      padding: 8px;
      border-bottom: 1px solid #ccc;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .shopItem button {
      padding: 5px 10px;
      cursor: pointer;
    }
    #modeButtons button {
      margin: 0 5px;
      padding: 8px 12px;
      cursor: pointer;
    }
    .heha {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 40px;
      background: white;
      padding: 10px;
      border: 3px solid red;
      animation: hehaFlash 0.4s linear infinite;
      z-index: 9999;
    }
    @keyframes hehaFlash {
      0% { opacity: 1; }
      50% { opacity: 0; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>

<audio id="bgMusic" src="https://cdn.pixabay.com/download/audio/2023/03/03/audio_96ecb1d20f.mp3?filename=motivational-sport-epic-142063.mp3" autoplay loop></audio>

<div id="ui">
  <div id="modeButtons">
    <button onclick="setMode('friend')">Play vs Friend</button>
    <button onclick="setMode('bot')">Play vs Bot</button>
    <button onclick="setMode('botvsbot')">Bot vs Bot</button>
  </div>
  <div id="currency">Dab Cones: 0</div>
</div>

<div id="tttGame">
  <h1>Tic Tac Toe</h1>
  <div id="board"></div>
  <div id="tttStatus"></div>
  <div id="shop"></div>
</div>

<script>
let board = [];
let currentTurn = 'X';
let mode = 'friend';
let gameOver = false;
let cones = 0;
let shopItems = [
  { name: "Win Bonus", cost: 50, bought: false },
  { name: "Spam HE HE HE HA (5s)", cost: 40, bought: false, effect: triggerHeHeHeHa }
];

function updateCurrency() {
  document.getElementById('currency').textContent = `Dab Cones: ${cones}`;
}

function setMode(m) {
  mode = m;
  startGame();
}

function startGame() {
  board = Array(9).fill('');
  currentTurn = 'X';
  gameOver = false;
  renderBoard();
  updateStatus(`Turn: ${currentTurn}`);
  renderShop();
  if (mode === 'botvsbot') botVsBot();
  updateCurrency();
}

function renderBoard() {
  const boardDiv = document.getElementById('board');
  boardDiv.innerHTML = '';
  board.forEach((cell, idx) => {
    const div = document.createElement('div');
    div.className = 'cell';
    div.textContent = cell;
    div.onclick = () => handleClick(idx);
    boardDiv.appendChild(div);
  });
}

function handleClick(i) {
  if (gameOver || board[i]) return;
  if (mode === 'botvsbot') return;
  if (mode === 'bot' && currentTurn === 'O') return;

  board[i] = currentTurn;
  renderBoard();
  checkGameEnd();

  if (!gameOver) {
    currentTurn = currentTurn === 'X' ? 'O' : 'X';
    updateStatus(`Turn: ${currentTurn}`);
    if (mode === 'bot' && currentTurn === 'O') setTimeout(botMove, 500);
  }
}

function updateStatus(text) {
  document.getElementById('tttStatus').textContent = text;
}

function checkGameEnd() {
  const wins = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];
  for (let combo of wins) {
    const [a, b, c] = combo;
    if (board[a] && board[a] === board[b] && board[b] === board[c]) {
      highlightCells(combo);
      updateStatus(`${board[a]} Wins!`);
      gameOver = true;
      if (mode === 'bot' && board[a] === 'X') cones += shopItems[0].bought ? 200 : 100;
      if (mode === 'bot' && board[a] === 'O') cones -= 100;
      updateCurrency();
      setTimeout(startGame, 2000);
      return;
    }
  }
  if (!board.includes('')) {
    updateStatus('Draw!');
    gameOver = true;
    setTimeout(startGame, 2000);
  }
}

function highlightCells(cells) {
  const cellDivs = document.querySelectorAll('.cell');
  cells.forEach(i => cellDivs[i].classList.add('highlight'));
}

function botMove() {
  let empty = board.map((v, i) => v === '' ? i : null).filter(v => v !== null);
  if (empty.length === 0) return;
  let move = empty[Math.floor(Math.random() * empty.length)];
  handleClick(move);
}

function botVsBot() {
  if (gameOver) return setTimeout(startGame, 1000);
  let empty = board.map((v, i) => v === '' ? i : null).filter(v => v !== null);
  if (empty.length === 0) return;
  let move = empty[Math.floor(Math.random() * empty.length)];
  board[move] = currentTurn;
  renderBoard();
  checkGameEnd();
  if (!gameOver) {
    currentTurn = currentTurn === 'X' ? 'O' : 'X';
    updateStatus(`Turn: ${currentTurn}`);
    setTimeout(botVsBot, 500);
  }
}

function renderShop() {
  const shop = document.getElementById('shop');
  shop.innerHTML = "<h3>Shop</h3>";
  shopItems.forEach((item, idx) => {
    const div = document.createElement('div');
    div.className = 'shopItem';
    div.innerHTML = `
      <span>${item.name} (${item.cost} cones)</span>
      <button ${item.bought ? "disabled" : ""} onclick="buyItem(${idx})">
        ${item.bought ? "Owned" : "Buy"}
      </button>
    `;
    shop.appendChild(div);
  });
}

function buyItem(i) {
  const item = shopItems[i];
  if (cones >= item.cost && !item.bought) {
    cones -= item.cost;
    item.bought = true;
    updateCurrency();
    if (item.effect) item.effect();
    renderShop();
  }
}

function triggerHeHeHeHa() {
  let count = 0;
  const interval = setInterval(() => {
    const div = document.createElement('div');
    div.className = 'heha';
    div.textContent = 'HE HE HE HA';
    document.body.appendChild(div);
    setTimeout(() => div.remove(), 400);
    if (++count >= 25) clearInterval(interval);
  }, 400);
}

startGame();
</script>
</body>
</html>

